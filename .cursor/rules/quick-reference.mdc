---
description: Quick reference for commands, key files, common tasks, testing patterns, and debugging tips
---

# Quick Reference

## Essential Commands

```bash
# Development
npm install          # Install dependencies
npm run compile      # Compile TypeScript
npm run watch        # Watch mode compilation
npm test             # Run tests
npm test -- --watch  # Watch mode tests
npm run lint         # Run ESLint
npm run format       # Format with Prettier

# Extension Keyboard Shortcuts
F5                   # Launch Extension Development Host
Ctrl+Shift+H         # Hide values (Windows/Linux)
Cmd+Shift+H          # Hide values (macOS)
Ctrl+Shift+R         # Reveal values (Windows/Linux)
Cmd+Shift+R          # Reveal values (macOS)
Ctrl+Shift+T         # Toggle value at cursor (Windows/Linux)
Cmd+Shift+T          # Toggle value at cursor (macOS)
Ctrl+Shift+S         # Toggle selective mode (Windows/Linux)
Cmd+Shift+S          # Toggle selective mode (macOS)

# Release (automated)
git commit -m "feat: new feature"  # Semantic commit
git push origin main               # Auto-release on merge
```

## Key Files

| File                       | Purpose                              |
| -------------------------- | ------------------------------------ |
| `src/extension.ts`         | Extension entry point & commands     |
| `src/core/camouflage.ts`   | Main business logic & decorations    |
| `src/parsers/index.ts`     | Parser registry & factory            |
| `src/parsers/base-parser.ts` | Abstract parser base               |
| `src/utils/config.ts`      | Configuration facade & file exclusion|
| `src/utils/file.ts`        | File utilities & format detection    |
| `package.json`             | Extension manifest & settings schema |
| `tsconfig.json`            | TypeScript config                    |
| `jest.config.js`           | Test config                          |
| `examples/`                | Example config files for all formats |

## Supported File Formats

| Format     | Extensions                          | Parser Class        |
| ---------- | ----------------------------------- | ------------------- |
| ENV        | `.env`, `.env.*`, `*.env`, `.envrc` | `EnvParser`         |
| Shell      | `.sh`                               | `EnvParser`         |
| JSON       | `.json`                             | `JsonParser`        |
| YAML       | `.yaml`, `.yml`                     | `YamlParser`        |
| Properties | `.properties`, `.ini`, `.conf`      | `PropertiesParser`  |
| TOML       | `.toml`                             | `TomlParser`        |

## Dependency Flow

```
extension.ts
    ↓
core/camouflage.ts
    ↓
parsers/ + lib/ + utils/
```

**Rules**:

- `parsers/` → File format parsing (Strategy Pattern)
- `lib/` → Pure functions only
- `utils/` → Can use VS Code API
- `core/` → Orchestrates everything
- No circular dependencies

## Common Tasks

### Add New Parser

1. Create parser file in `src/parsers/`:

```typescript
import { BaseParser } from './base-parser';
import type { ParsedVariable } from './types';

export class NewParser extends BaseParser {
  readonly name = 'new';
  readonly supportedExtensions = ['.new'];

  parse(content: string): ParsedVariable[] {
    const variables: ParsedVariable[] = [];
    // Parse content and populate variables
    return variables;
  }
}
```

2. Register in `src/parsers/index.ts`:

```typescript
import { NewParser } from './new-parser';

// In ParserRegistry constructor:
this.registerParser(new NewParser());
```

3. Update `package.json` (enabledParsers enum):

```json
"camouflage.files.enabledParsers": {
  "items": {
    "enum": ["env", "json", "yaml", "properties", "toml", "new"]
  }
}
```

4. Add tests in `src/parsers/__tests__/new-parser.test.ts`
5. Update README with examples

### Add New Hiding Style

1. Update `package.json`:

```json
"enum": ["text", "dotted", "stars", "scramble", "newStyle"]
```

2. Update `text-generator.ts`:

```typescript
const strategies: Record<HiddenTextStyle, GeneratorStrategy> = {
  // ... existing
  newStyle: (text) => transformText(text),
};
```

3. Add tests:

```typescript
it('should generate newStyle text', () => {
  expect(generateHiddenText('test', 'newStyle')).toBe('expected');
});
```

4. Update README with example

### Add New Command

1. Update `package.json`:

```json
"commands": [{
  "command": "camouflage.newCommand",
  "title": "Camouflage: New Command"
}]
```

2. Register in `extension.ts`:

```typescript
const command = vscode.commands.registerCommand('camouflage.newCommand', () =>
  camouflage.newCommand()
);
context.subscriptions.push(command);
```

3. Implement in `camouflage.ts`:

```typescript
@Log('New Command')
@HandleErrors
public newCommand(): void {
  // Implementation
}
```

### Add New Configuration

1. Update `package.json`:

```json
"camouflage.newSetting": {
  "type": "boolean",
  "default": true,
  "description": "New setting description"
}
```

2. Add getter in `config.ts`:

```typescript
export function getNewSetting(): boolean {
  return vscode.workspace.getConfiguration('camouflage').get<boolean>('newSetting', true);
}
```

3. Use in code:

```typescript
import * as config from '../utils/config';

if (config.getNewSetting()) {
  // Do something
}
```

## Testing Patterns

### Unit Test Template

```typescript
describe('functionName', () => {
  beforeEach(() => {
    // Setup
  });

  afterEach(() => {
    // Cleanup
  });

  it('should handle normal case', () => {
    // Arrange
    const input = 'test';

    // Act
    const result = functionName(input);

    // Assert
    expect(result).toBe('expected');
  });

  it('should handle edge case', () => {
    expect(functionName('')).toBe('');
  });

  it('should throw on invalid input', () => {
    expect(() => functionName(null)).toThrow();
  });
});
```

### Parser Test Template

```typescript
describe('NewParser', () => {
  let parser: NewParser;

  beforeEach(() => {
    parser = new NewParser();
  });

  describe('canParse', () => {
    it('should return true for .new files', () => {
      expect(parser.canParse('config.new')).toBe(true);
    });

    it('should return false for other files', () => {
      expect(parser.canParse('config.txt')).toBe(false);
    });
  });

  describe('parse', () => {
    it('should parse key-value pairs', () => {
      const content = 'key=value';
      const result = parser.parse(content);

      expect(result).toHaveLength(1);
      expect(result[0].key).toBe('key');
      expect(result[0].value).toBe('value');
    });
  });
});
```

## Design Patterns Used

### Strategy (Parsers)

```typescript
// Parser interface
interface Parser {
  parse(content: string): ParsedVariable[];
  canParse(fileName: string): boolean;
}

// Registry selects parser by file type
const parser = parserRegistry.findParserForFile(fileName);
const variables = parser.parse(content);
```

### Decorator

```typescript
@Log('Message')
@HandleErrors
@Debounce(100)
public method(): void { }
```

### Facade

```typescript
import * as config from '../utils/config';

if (config.isEnabled()) {
  const style = config.getHidingStyle();
}
```

## Configuration Access

```typescript
// Get value with default
const isEnabled = vscode.workspace.getConfiguration('camouflage').get<boolean>('enabled', true);

// Update value
await vscode.workspace
  .getConfiguration('camouflage')
  .update('enabled', false, vscode.ConfigurationTarget.Global);

// Listen for changes
vscode.workspace.onDidChangeConfiguration((event) => {
  if (event.affectsConfiguration('camouflage')) {
    // Reload
  }
});
```

## Event Handling

```typescript
// Document changes (debounce this!)
vscode.workspace.onDidChangeTextDocument((event) => {
  if (event.document === vscode.window.activeTextEditor?.document) {
    updateDecorations();
  }
});

// Editor changes
vscode.window.onDidChangeActiveTextEditor((editor) => {
  if (editor && isSupportedFile(editor.document.fileName)) {
    updateDecorations();
  }
});

// Always register for disposal
context.subscriptions.push(vscode.workspace.onDidChangeTextDocument(handler));
```

## Resource Disposal

```typescript
export function deactivate(): void {
  // Dispose resources
  if (decorationType) {
    decorationType.dispose();
  }
}

// Or register for auto-disposal
context.subscriptions.push(statusBarItem, decorationType, command);
```

## Code Quality Checks

```typescript
// ✅ Always use === not ==
if (value === 'test') {
}

// ✅ Use curly braces even for single line
if (condition) {
  doSomething();
}

// ✅ Optional chaining
const fileName = editor?.document?.fileName;

// ✅ Nullish coalescing
const timeout = config.get('timeout') ?? 300;

// ✅ Async/await not .then()
const result = await fetchData();

// ✅ Ignore unused params with _
function handler(_param: string, used: number) {}

// ✅ Prefer const over let
const value = getValue();
```

## Commit Messages

```bash
# Feature (minor version bump)
git commit -m "feat(parsers): add TOML parser support"

# Bug fix (patch version bump)
git commit -m "fix(json-parser): handle escaped quotes"

# Breaking change (major version bump)
git commit -m "feat(core): redesign parser API

BREAKING CHANGE: Parser interface changed"

# Other types (no version bump)
git commit -m "docs: update README examples"
git commit -m "test: add JSON parser tests"
git commit -m "refactor(parsers): extract base parser"
git commit -m "chore: update dependencies"
```

## Debugging

### VS Code Extension Debugging

1. Press F5 to launch Extension Development Host
2. Open Debug Console in main VS Code window
3. Set breakpoints in source code
4. Extension runs in new window

### Common Issues

**Extension not activating**

- Check activation events in package.json
- Look for errors in Debug Console
- Verify file patterns match

**Decorations not showing**

- Check if file is recognized (use `isSupportedFile()`)
- Verify parser returns correct positions
- Verify configuration is enabled
- Look for errors in console

**Parser not working**

- Check `canParse()` returns true for file
- Verify regex patterns are correct
- Check `startIndex` and `endIndex` positions
- Add console.log in parse method

**Tests failing**

- Clear Jest cache: `npm test -- --clearCache`
- Check mock setup in `__mocks__/vscode.ts`
- Verify imports are correct

## Performance Tips

```typescript
// ✅ Debounce frequent operations
@Debounce(100)
private updateDecorations(): void { }

// ✅ Cache expensive computations
private regexCache = new Map<string, RegExp>();

// ✅ Use optional chaining to avoid null checks
const text = editor?.document?.getText();

// ✅ Early returns to avoid nesting
if (!editor) return;
if (!isSupportedFile(editor.document.fileName)) return;

// ✅ Batch operations
const ranges = getAllRanges();
editor.setDecorations(decorationType, ranges);
```

## Security Checklist

- [ ] No file modifications
- [ ] No network requests with sensitive data
- [ ] All user input validated
- [ ] Patterns sanitized before regex compilation
- [ ] No logging of values
- [ ] No telemetry of sensitive data
- [ ] Errors don't leak information

## Useful VS Code API

```typescript
// Current editor
const editor = vscode.window.activeTextEditor;

// Current document
const document = editor?.document;

// Status bar
const statusBar = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Right, 100);

// Messages
vscode.window.showInformationMessage('Info');
vscode.window.showWarningMessage('Warning');
vscode.window.showErrorMessage('Error');

// Commands
await vscode.commands.executeCommand('command.id');

// Configuration
const config = vscode.workspace.getConfiguration('camouflage');
const value = config.get<boolean>('enabled', true);

// Ranges
const range = new vscode.Range(new vscode.Position(0, 0), new vscode.Position(0, 10));

// Decorations
const decorationType = vscode.window.createTextEditorDecorationType({
  color: '#FF0000',
  backgroundColor: '#00000000',
});
editor.setDecorations(decorationType, [range]);
```

## File Detection

```typescript
import { getParserRegistry, isSupportedFile } from '../parsers';

// Check if file is supported
if (isSupportedFile(fileName)) {
  // File can be parsed
}

// Get parser for file
const registry = getParserRegistry();
const parser = registry.findParserForFile(fileName);
if (parser) {
  const variables = parser.parse(content);
}
```

## Regular Expressions

```typescript
// Env variable pattern: KEY=VALUE
const ENV_VAR_REGEX = /^([A-Z_][A-Z0-9_]*)\s*=\s*(.*)$/;

// JSON string value: "key": "value"
const JSON_STRING_REGEX = /"([^"]+)"\s*:\s*"([^"]*)"/g;

// Wildcard pattern conversion
const pattern = '*API*';
const escaped = pattern.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
const regexPattern = escaped.replace(/\\\*/g, '.*');
const regex = new RegExp(regexPattern, 'i');
```

## Module Exports

```typescript
// ✅ Prefer named exports
export function functionName(): void {}
export class ClassName {}
export interface InterfaceName {}

// ❌ Avoid default exports
export default function () {} // No
```

## VS Code Extension Manifest

```json
{
  "name": "camouflage",
  "displayName": "Camouflage",
  "description": "Hide sensitive values in configuration files",
  "version": "1.1.2",
  "publisher": "zeybek",
  "engines": {
    "vscode": "^1.96.0"
  },
  "categories": ["Other"],
  "activationEvents": [
    "onLanguage:dotenv",
    "onLanguage:properties",
    "onLanguage:plaintext",
    "onLanguage:json",
    "onLanguage:yaml",
    "onLanguage:toml",
    "onStartupFinished"
  ],
  "main": "./dist/extension.js",
  "contributes": {
    "commands": [],
    "configuration": {},
    "keybindings": [],
    "menus": {}
  }
}
```

## References

For detailed information:

- **Architecture**: See `architecture.mdc`
- **Coding Standards**: See `coding-standards.mdc`
- **Testing**: See `testing.mdc`
- **Git Workflow**: See `git-workflow.mdc`
- **VS Code Extension**: See `vscode-extension.mdc`
- **Security**: See `security.mdc`
- **Patterns**: See `patterns.mdc`
- **AI Guidelines**: See `ai-guidelines.mdc`
